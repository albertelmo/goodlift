# 트레이너 세션 성능 개선 단계별 실행 계획

## 📋 전체 개요

총 **7단계**로 나누어 점진적으로 개선합니다. 각 단계는 독립적으로 테스트 가능하며, 문제 발생 시 이전 단계로 롤백할 수 있습니다.

---

## 🎯 Step 1: renderCalUI 내부 중복 호출 제거
**우선순위**: ⭐⭐⭐ (최우선)  
**예상 소요 시간**: 30분  
**리스크**: 낮음  
**백엔드 변경**: 없음

### 목표
- `renderCalUI` 함수 내에서 전체 세션을 가져온 후, 같은 함수 내에서 특정 날짜 세션을 다시 요청하는 중복을 제거
- 전체 세션에서 날짜별로 필터링하여 사용

### 작업 내용
1. `renderCalUI` 함수에서 전체 세션 조회 후 날짜별 필터링
2. `updateTimeDropdowns` 함수에 `daySessions` 파라미터 전달
3. 1077줄의 중복 API 호출 제거

### 예상 효과
- `renderCalUI` 호출 시 API 요청 수: 2-3회 → 1회 (50-67% 감소)
- 즉시 체감 가능한 성능 개선

### 테스트 방법
- 캘린더 렌더링 시 네트워크 탭에서 API 호출 수 확인
- 시간 드롭다운이 정상 작동하는지 확인

---

## 🎯 Step 2: 단일 세션 조회 API 추가 (백엔드)
**우선순위**: ⭐⭐  
**예상 소요 시간**: 20분  
**리스크**: 낮음  
**백엔드 변경**: 있음

### 목표
- 단일 세션 조회를 위한 전용 API 엔드포인트 추가
- 모달에서 전체 세션을 가져와 필터링하는 비효율 제거

### 작업 내용
1. `backend/sessions-db.js`에 `getSessionById` 함수 추가
2. `backend/server.js`에 `GET /api/sessions/:id` 엔드포인트 추가
3. 에러 처리 및 검증 로직 추가

### 예상 효과
- 모달 열 때 데이터 전송량: 전체 세션 → 단일 세션 (90% 이상 감소)
- API 응답 시간 단축

### 테스트 방법
- `GET /api/sessions/:id` 직접 호출 테스트
- 존재하지 않는 ID로 404 응답 확인

---

## 🎯 Step 3: 모달에서 단일 세션 조회 사용
**우선순위**: ⭐⭐  
**예상 소요 시간**: 30분  
**리스크**: 낮음  
**백엔드 변경**: 없음  
**의존성**: Step 2 완료 필요

### 목표
- `renderSignBody`, `renderChangeBody` 등 모달 함수에서 단일 세션 조회 API 사용
- 전체 세션 조회 제거

### 작업 내용
1. `renderSignBody` 함수 수정 (2650줄)
2. `renderChangeBody` 함수 수정 (2776줄)
3. 전체 세션 조회 로직을 단일 세션 조회로 변경

### 예상 효과
- 모달 열 때 API 호출 시간 90% 이상 단축
- 데이터 전송량 대폭 감소

### 테스트 방법
- 출석 모달, 변경 모달 등 모든 모달 정상 작동 확인
- 네트워크 탭에서 데이터 전송량 확인

---

## 🎯 Step 4: 캐싱 구조 및 유틸리티 함수 추가
**우선순위**: ⭐⭐⭐  
**예상 소요 시간**: 40분  
**리스크**: 낮음 (아직 사용하지 않음)  
**백엔드 변경**: 없음

### 목표
- 캐싱 관련 함수들을 미리 구현
- `calState`에 캐시 구조 추가
- 실제 사용은 Step 5에서 시작

### 작업 내용
1. `calState`에 `sessionsCache` 객체 추가
2. `getCachedSessions()` 함수 구현
3. `setCachedSessions()` 함수 구현
4. `invalidateSessionsCache()` 함수 구현
5. 캐시 TTL 상수 정의 (기본 5분)

### 예상 효과
- Step 5를 위한 기반 구조 준비
- 캐시 로직을 독립적으로 테스트 가능

### 테스트 방법
- 캐시 함수들이 정상 작동하는지 단위 테스트
- 캐시 저장/조회/무효화 로직 검증

---

## 🎯 Step 5: renderCalUI에 캐싱 적용
**우선순위**: ⭐⭐⭐  
**예상 소요 시간**: 1시간  
**리스크**: 중간  
**백엔드 변경**: 없음  
**의존성**: Step 4 완료 필요

### 목표
- `renderCalUI` 함수에서 캐시를 먼저 확인하고, 없을 때만 API 호출
- 캐시가 유효하면 API 호출 생략

### 작업 내용
1. `renderCalUI` 함수 시작 부분에 캐시 확인 로직 추가
2. 캐시가 없거나 만료된 경우에만 API 호출
3. API 응답 후 캐시에 저장
4. 캐시에서 가져온 데이터로 렌더링

### 예상 효과
- 캐시 유효 시 API 호출 100% 제거
- 페이지 전환, 날짜 변경 시 즉각적인 렌더링
- 전체 페이지 로드 시간 50-70% 단축

### 테스트 방법
- 첫 렌더링: API 호출 확인
- 두 번째 렌더링: 캐시 사용 확인 (API 호출 없음)
- 캐시 만료 후: 다시 API 호출 확인

---

## 🎯 Step 6: 캐시 무효화 로직 추가
**우선순위**: ⭐⭐⭐  
**예상 소요 시간**: 1시간  
**리스크**: 중간  
**백엔드 변경**: 없음  
**의존성**: Step 5 완료 필요

### 목표
- 세션 추가/수정/삭제 시 캐시를 무효화하여 최신 데이터 보장
- 데이터 일관성 유지

### 작업 내용
1. 세션 추가 후 캐시 무효화 (1195줄, 1257줄)
2. 세션 수정 후 캐시 무효화 (2939줄)
3. 세션 삭제 후 캐시 무효화 (2978줄)
4. 출석 처리 후 캐시 무효화 (2737줄)
5. 날짜별 캐시 선택적 무효화 고려

### 예상 효과
- 데이터 일관성 보장
- 불필요한 캐시 사용 방지
- 사용자가 수정한 내용이 즉시 반영

### 테스트 방법
- 세션 추가 후 캐시가 무효화되는지 확인
- 수정/삭제 후에도 최신 데이터가 표시되는지 확인
- 여러 작업 연속 수행 시 데이터 일관성 확인

---

## 🎯 Step 7: 날짜별 캐싱 및 최적화
**우선순위**: ⭐  
**예상 소요 시간**: 1시간  
**리스크**: 낮음  
**백엔드 변경**: 없음  
**의존성**: Step 5, 6 완료 필요

### 목표
- 날짜별 세션을 개별적으로 캐싱
- 메모리 사용량 최적화
- LRU 캐시 고려 (선택사항)

### 작업 내용
1. 날짜별 캐시 구조 개선
2. `updateTimeDropdowns`에서 날짜별 캐시 활용
3. 메모리 관리: 오래된 캐시 자동 삭제 (선택사항)
4. 주간보기 시 주간 범위 캐싱 (선택사항)

### 예상 효과
- 날짜 변경 시 캐시 활용으로 즉각적인 반응
- 메모리 사용량 최적화
- 장기간 사용 시에도 성능 유지

### 테스트 방법
- 여러 날짜를 전환하며 캐시 활용 확인
- 메모리 사용량 모니터링
- 장시간 사용 후 성능 확인

---

## 📊 단계별 예상 개선 효과 요약

| Step | API 호출 감소 | 데이터 전송 감소 | 로드 시간 단축 | 누적 효과 |
|------|-------------|----------------|--------------|----------|
| Step 1 | 50-67% | - | 20% | 중간 |
| Step 2 | - | - | - | - |
| Step 3 | - | 90% | 30% | 중간 |
| Step 4 | - | - | - | - |
| Step 5 | 70-100% (캐시 시) | - | 50-70% | 높음 |
| Step 6 | - | - | - | - |
| Step 7 | 추가 10-20% | - | 추가 10% | 매우 높음 |

**최종 예상 효과**: API 호출 80-90% 감소, 로드 시간 50-70% 단축

---

## 🚀 실행 순서 권장사항

### 빠른 효과를 원하는 경우
1. **Step 1** (즉시 효과)
2. **Step 2 → Step 3** (모달 최적화)
3. **Step 4 → Step 5** (캐싱)

### 안정성을 우선하는 경우
1. **Step 1** (리스크 낮음, 즉시 효과)
2. **Step 4** (구조만 추가, 사용 안 함)
3. **Step 5** (캐싱 적용)
4. **Step 6** (무효화)
5. **Step 2 → Step 3** (모달 최적화)
6. **Step 7** (최종 최적화)

### 단계별 롤백 계획
- 각 단계는 독립적으로 롤백 가능
- Git 커밋을 단계별로 분리하여 관리 권장
- Step 5 이후부터는 캐시 관련 이슈 가능성 있으므로 주의

---

## ⚠️ 주의사항

1. **Step 5 이후**: 캐시 무효화 로직이 제대로 작동하지 않으면 오래된 데이터가 표시될 수 있음
2. **Step 6 필수**: Step 5를 적용했다면 반드시 Step 6도 함께 적용해야 함
3. **캐시 TTL 조정**: 실제 사용 패턴에 따라 TTL 조정 필요 (기본 5분)
4. **브라우저 개발자 도구**: 각 단계마다 네트워크 탭에서 API 호출 확인

---

## 📝 체크리스트

각 단계 완료 후 확인:

- [ ] Step 1: 중복 호출 제거 확인
- [ ] Step 2: 단일 세션 API 정상 작동 확인
- [ ] Step 3: 모달 정상 작동 확인
- [ ] Step 4: 캐시 함수 정상 작동 확인
- [ ] Step 5: 캐시 적용 후 성능 개선 확인
- [ ] Step 6: 캐시 무효화 정상 작동 확인
- [ ] Step 7: 최종 최적화 확인

---

## 🎯 다음 단계

어떤 단계부터 시작할지 알려주시면 해당 단계를 구현하겠습니다.

**추천**: Step 1부터 시작 (가장 간단하고 즉시 효과)
